---
title: "Scorigami!"
subtitle: "Using Markov Chains to Model Unique NFL Game Scores"
author: "Austin Redmond"
date: "3/12/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, root.dir = "~/GitHub/ScorigamiMC")
```

# Introduction

Scorigami is the "art of achieving a final score in an NFL game that has never happened before" (Bois). The final score of an NFL game consists of the total points scored by each of the two teams. Scoring in the NFL All NFL scores are made of 5 different methods of scoring points. THe  (Bois, 7:19)

# Literature Review

# Methodology

### My Library

```{r My Library}

multi_scrape_game_ids <- function(seasons, types, weeks = NULL, teams = NULL) {
  library(nflscrapR)
  
  #Schema of the scraped game IDs data frame.
  scrapedGameIDsColNames <- c("type", "game_id", "home_team", "away_team", "week", "season", "state_of_game", "game_url", "home_score", "away_score")
  #Create scraped game IDs data frame with a matching number of columns.
  scrapedGameIDs <- as.data.frame(matrix(,0,length(scrapedGameIDsColNames)))
  #Rename columns of scraped game IDs data frame.
  names(scrapedGameIDs) <- scrapedGameIDsColNames
  
  #Loop for each season and each type of game (which is either preseason, regular season, or postseason).
  for(s in seasons) {
    for(ty in types) {
      #Bind the data scraped so far with the data scraped using the current season, game type, week, and team information.
      scrapedGameIDs <- rbind(scrapedGameIDs, scrape_game_ids(s, ty, weeks = weeks, teams = teams))
    }
  }
  
  #Return the scraped gamed IDs data frame.
  return(scrapedGameIDs)
}

multi_scrape_game_play_by_play <- function(gameIDs) {
  library(nflscrapR)  
  
  #Create an empty list for each game ids' play-by-play data.
  scrapedGamePlayByPlayList = list()
  
  #Loop for each game id.
  for(i in 1:nrow(gameIDs)) {
    
    #Bind the data scraped so far with the data scraped using the current game id.
    scrapedGamePlayByPlayList[[i]] <- scrape_game_play_by_play(gameIDs[i,"game_id"], gameIDs[i,"type"], gameIDs[i,"season"], 0)[x$time=="15:00",c("game_id","home_team","away_team","qtr","total_home_score","total_away_score")]
  }
  
  #
  scrapedGamePlayByPlay <- do.call(rbind, scrapedGamePlayByPlayList)
  
  return(scrapedGamePlayByPlay)
}
```


### Data Scraping

#### Install nflscrapR

nflscrapR is an R package that is used to "utilize and analyze data from the National Football League (NFL) API". It is necessary to install it in order to scrape data pertaining to NFL box scores. The nflscrapR package can be found at https://github.com/maksimhorowitz/nflscrapR. The devtools package can install R packages hosted on Github.
  
```{r Installation of nflscrapR, message=FALSE}

library(devtools)

#Install nflscrapR from Github using devtools.
devtools::install_github(repo = "maksimhorowitz/nflscrapR")

```

#### Scrape Game IDs

```{r Scrape Game IDS, message=FALSE, cache=TRUE}

#Scrape all regular and post season game ids from 2009 to 2018.
scrapedGameIDs <- multi_scrape_game_ids(2009:2018, c("reg", "post"))

#Display the first six observations.
head(scrapedGameIDs)

#Save scraped game ids to file.
save(scrapedGameIDs, file = "scrapedGameIDs.Rda")

```

#### Scrape Game Play-by-Play

```{r Scape Game Play-by-Play, message=FALSE, cache=TRUE }

#Load the scraped game ids data frame from file.
load("scrapedGameIDs.Rda")

#Scrape play-by-play data of all selected games.
scrapedGamedPlayByPlay <- multi_scrape_game_play_by_play(scrapedGameIDs)

#Display the first six observations.
head(scrapedGamedPlayByPlay)

#Save scraped game play-by-play data to file.
save(scrapedGamedPlayByPlay, file = "scrapedGamePlayByPlay.Rda")

```



# Works Cited

Bois, John. "Every NFL Score Ever | Chart Party". *Youtube*, SB Nation, December 7, 2016, https://www.youtube.com/watch?v=9l5C8cGMueY.

Horowitz, Marksim. "Introducing the nflscrapR Package." Github, https://github.com/maksimhorowitz/nflscrapR. Accessesd 15 November 2019.

https://seahawkswire.usatoday.com/2018/12/03/seahawks-continue-bizarre-scorigami-streak-under-pete-carroll/

```{r Testing}
x <- scrape_game_play_by_play(scrapedGameIDs[1,"game_id"], scrapedGameIDs[1,"type"], scrapedGameIDs[1,"season"])
y <- x[x$time=="15:00",c("game_id","home_team","away_team","qtr","total_home_score","total_away_score")]
```

