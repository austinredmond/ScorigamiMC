---
title: "Scorigami! Using Markov Chains to Model Unique NFL Game Scores"
author: "Austin Redmond"
date: "26/11/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, root.dir = "~/GitHub/ScorigamiMC")
```

# Abstract



# Introduction

"Scorigami is the art of achieving a final score in an NFL game that has never happened before. It is a term made up by Jon Bois, a concept perfected by Pete Carroll, and a goal that may not be completed before the heat death of the universe."

# Literature Review

# Methodology

### My Library

```{r My Library}
multi_scrape_game_ids <- function(seasons, types, weeks = NULL, teams = NULL) {
  library(nflscrapR)
  
  #Schema of the scraped game IDs data frame.
  scrapedGameIDsColNames <- c("type", "game_id", "home_team", "away_team", "week", "season", "state_of_game", "game_url", "home_score", "away_score")
  #Create scraped game IDs data frame with a matching number of coluformns.
  scrapedGameIDs <- as.data.frame(matrix(,0,length(scrapedGameIDsColNames)))
  #Rename columns ofscraped game IDs  data frame.
  names(scrapedGameIDs) <- scrapedGameIDsColNames
  
  for(s in seasons) {
    for(ty in types) {
      scrapedGameIDs <- rbind(scrapedGameIDs, scrape_game_ids(s, ty, weeks = weeks, teams = teams))
    }
  }
  
  return(scrapedGameIDs)
}

multi_scrape_game_play_by_play <- function(gameIDs) {
  #Schema of the scraped game play-by-play.
  View(gameIDs)
  scrapedGamedPlayByPlay <- as.data.frame(scrape_game_play_by_play(gameIDs[1,"game_id"], gameIDs[1,"type"], gameIDs[1,"season"])[0,])
  
  for(i in gameIDs$game_id) {
    scrapedGamedPlayByPlay <- rbind(scrapedGamedPlayByPlay, scrape_game_play_by_play(gameIDs[i,"game_id"], gameIDs[i,"type"], gameIDs[i,"season"]))
  }
  
  return(scrapedGamedPlayByPlay)
}
```


### Data Scraping

#### Install nflscrapR

nflscrapR is an R package that is used to "utilize and analyze data from the National Football League (NFL) API". It is necessary to install it in order to scrape data pertaining to NFL box scores. The nflscrapR package can be found at https://github.com/maksimhorowitz/nflscrapR. The devtools package can install R packages hosted on Github.
  
```{r Installation, message=FALSE}
library(devtools)

#Install nflscrapR from Github using devtools.
devtools::install_github(repo = "maksimhorowitz/nflscrapR")

```

#### Scrape Game IDs

```{r Scrape Game IDS, message=FALSE}

scrapedGameIDs <- multi_scrape_game_ids(2009:2018, c("reg", "post"))
head(scrapedGameIDs)

save(scrapedGameIDs, file = "scrapedGameIDs.Rda")

```

#### Scrape Game Play-by-Play

```{r}
load("scrapedGameIDs.Rda")

scrapedGamedPlayByPlay <- multi_scrape_game_play_by_play(scrapedGameIDs)
head(scrapedGamedPlayByPlay)

save(scrapedGamedPlayByPlay, file = "scrapedGamePlayByPlay.Rda")

```



# Works Cited

https://www.youtube.com/watch?v=9l5C8cGMueY

Horowitz, Marksim. "Introducing the nflscrapR Package." Github, https://github.com/maksimhorowitz/nflscrapR. Accessesd 15 November 2019.

https://seahawkswire.usatoday.com/2018/12/03/seahawks-continue-bizarre-scorigami-streak-under-pete-carroll/

```{r Testing}

scrapedGameIDs <- load("scrapedGameIDs.Rda")

prmatrix(matrix(paste(colnames(initialData), ": ", sapply(initialData, class), sep=""), nrow = 7, ncol = 7), rowlab=rep("",7), collab=rep("",7))

x <- scrape_game_play_by_play(2018111900, "reg", 2018, check_url = 1)
x <- as.data.frame(x)

prmatrix(matrix(paste(colnames(x), ": ", sapply(x, class), sep=""), nrow = 86, ncol = 3), rowlab=rep("",86), collab=rep("",3))
class(x)
View(cbind(x[x$quarter_end == 1,]$total_away_score, x[x$quarter_end == 1,]$total_home_score))

class(x)
unique(x$PlayType)
View(x[x$PlayType=="Quarter End" | x$PlayType=="End of Game",])

scrapedGameIDs <- scrape_game_play_by_play(scrapedGameIDs[1,"game_id"], scrapedGameIDs[1,"type"], scrapedGameIDs[1,"season"])

scrapedGamedPlayByPlay <- as.data.frame(scrape_game_play_by_play(scrapedGameIDs[1,"game_id"], scrapedGameIDs[1,"type"], scrapedGameIDs[1,"season"])[0,])

```

